# Vibe Hosting / Vibe Apps - プロダクト要件定義（PRD）

## 概要
Vibe Hosting / Vibe Apps は、自然言語のヒアリングを通じて Next.js（App Router, TypeScript）を用いたフルスタック Web アプリケーションを自動生成・デプロイするサービス。DB・認証・決済・管理画面を含む業務ロジックまで生成し、Vercel/Cloudflare Pages へのデプロイとプレビュー提供を行う。

## ゴール / 非ゴール
- ゴール（MVP）
  - 1 つの代表ユースケース（例：青果物 EC）の要件を自然言語で入力すると、Next.js + DB 接続済みのアプリが自動生成され、プレビュー URL を提供する。
  - ユーザの追加入力に応じて要件をブラッシュアップし、再生成・再デプロイができる。
- 非ゴール
  - 複数プロジェクト同時生成のキューイング最適化。
  - マルチリージョン/マルチクラウドの高可用構成。
  - 完全な多言語 UI 対応や高度なデザインカスタム。

## ユースケース・ユーザストーリー
1. **青果物 EC オーナーがサイトを立ち上げる**
   - 入力：店舗情報、商品カテゴリ、決済手段、在庫管理の要望。
   - システム応答：追加質問（配送フロー、税計算方法、在庫単位など）→ Next.js + Supabase で EC サイト生成 → Vercel にデプロイしプレビュー URL 提供。
   - 成果物：商品登録・一覧・詳細・カート・決済・在庫管理・注文履歴が動くアプリ。
2. **経営者が自然言語で修正依頼**
   - 入力：「予約時に事前決済を必須にしたい」「顧客一覧にタグ付けしたい」など。
   - システム応答：要件差分を解析し、DB スキーマ/Server Actions/UI を再生成、再デプロイ。
   - 成果物：差分が反映された新バージョンとプレビュー URL。
3. **会員制サイトの立ち上げ**
   - 入力：会員プラン定義、ログイン/登録要件、コンテンツ配信方法。
   - システム応答：認証設定（Email/OTP など）と権限ロールを生成、コンテンツ配信用ページと管理画面を用意。
   - 成果物：ログイン・会員プラン・決済・コンテンツ閲覧が揃ったサイト。

## ペルソナ
- 技術リテラシーが低いビジネスオーナーを想定。UI は対話ファースト、専門用語を避け、追加質問は選択肢＋自由入力の併用。

## 機能要件（Functional Requirements）
### AI 要件定義・ヒアリングモジュール
- 概要：ユーザ入力を元に追加質問を生成し、要件を構造化。
- 入力：自然言語の要望、業務フロー、既存システム有無。
- 出力：構造化要件（データモデル、機能一覧、権限、外部連携）。
- 制約：曖昧さを残さないため、最低 3 ラウンドの確認質問を行う。

### プロジェクトスキャフォールド生成
- 概要：Next.js (App Router/TS) ベースのプロジェクトを自動生成。
- 入力：構造化要件、ターゲットデプロイ先。
- 出力：Next.js プロジェクト構造、package.json、基本設定。
- 制約：Server Actions/API Routes を活用、環境変数は .env.local に集約。

### DB スキーマ設計・マイグレーション生成
- 概要：Prisma などを用いてスキーマ定義とマイグレーションを生成。
- 入力：データモデル要件、リレーション情報。
- 出力：schema.prisma、初期マイグレーションファイル。
- 制約：MVP は Supabase/Postgres 固定。安全な型・制約（unique/index）を自動設定。

### API / Server Actions 生成
- 概要：CRUD、決済、認証、予約などの業務ロジックを実装。
- 入力：機能要件、DB スキーマ。
- 出力：/app/api/* もしくは Server Actions の実装。
- 制約：認証済みユーザ前提のエンドポイントは middleware で保護。

### フロントエンド UI 生成
- 概要：一覧/詳細/フォーム/ダッシュボード UI を自動生成。
- 入力：画面要件、情報設計、コンポーネントポリシー。
- 出力：App Router 配下のページ、共通レイアウト、UI コンポーネント。
- 制約：MVP はプレーン Tailwind UI ベース、アクセシビリティ指針に準拠。

### デプロイ設定
- 概要：Vercel/Cloudflare Pages への自動デプロイ設定。
- 入力：デプロイ先、環境変数、ビルドコマンド。
- 出力：プロジェクト設定ファイル、CI/CD スクリプト。
- 制約：SSR/Server Actions が動作する構成を優先、DB 接続設定を分離。

### プレビュー URL 発行
- 概要：生成・デプロイ後に共有可能なプレビュー URL を発行。
- 入力：デプロイ成果。
- 出力：プレビュー URL、デプロイログ。
- 制約：再生成時はバージョンを保持しロールバック可能にする。

### ソースコードエクスポート / ダウンロード
- 概要：生成済みコードを zip/Git リポジトリとして出力。
- 入力：ユーザリクエスト。
- 出力：ダウンロードリンク、Git リポジトリ URL。
- 制約：秘密情報は除外、README と環境変数テンプレートを同梱。

## 非機能要件（Non-Functional Requirements）
- パフォーマンス：生成〜デプロイを 15 分以内に完了することを目標。
- セキュリティ：認証情報は秘密管理、API キーはユーザごとに分離。生成コードには OWASP Top 10 対策をテンプレ化。
- 可用性・運用：生成ジョブの再実行と失敗時のリトライ、ログ収集/エラートラッキングを標準搭載。
- DX：AI 生成コードに自動テスト・Lint 設定を含め、ダウンロード後の開発体験を担保。

## システムアーキテクチャ概要（MVP）
- フロントエンド：Next.js (App Router/TS) で対話 UI とプレビュー管理。
- バックエンド：同一 Next.js プロジェクト内の API Routes/Server Actions。必要に応じ外部ワーカーで生成ジョブ実行。
- AI 連携：外部 LLM API（Claude/GPT 系）を利用し、ヒアリングとコード生成を担当。
- DB：Supabase/Postgres を標準。Prisma でスキーマ管理。
- デプロイ：Vercel または Cloudflare Pages。環境変数とビルド設定はターゲットに応じて切替。

## スコープ（MVPで実装する範囲）
- 青果物 EC シナリオをフルで通す（商品登録〜決済〜管理画面）。
- 認証は Email/OTP のみ、支払いは Stripe に固定。
- 多言語対応・マルチテナント高度化・複数 DB サポートは後回し。

## KPI / 成功指標（MVP）
- 生成〜デプロイ完了までの平均時間（目標 15 分以内）。
- 初期ユーザからの「自力では作れなかった」満足度スコア（70%以上）。
- 手動受託開発と比較した工数削減率（50%以上）。
- 生成後のプレビュー利用率とフィードバック回収数。

## オープンな課題・未決事項
- 認証方式の選定拡張（OAuth, WebAuthn）のタイミング。
- DB オプション拡充（PlanetScale/MySQL, DynamoDB 等）と抽象化層の設計。
- 決済手段追加（PayPal, Apple Pay）と PCI DSS 周辺の責任分解点。
- AI モデル選定とプロンプトパイプライン（安全性・コスト最適化）。
- デプロイ後の監視/アラート設計とエッジ/サーバレスの使い分け。
